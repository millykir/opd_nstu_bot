import asyncio
from telegram import Bot
from telegram.error import TelegramError

# --- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ó–ê–ü–û–õ–ù–ò–¢–ï ---
TELEGRAM_BOT_TOKEN = "8207295383:AAF48JAHNXL1CLOfbozXakb19auhcrQIqNg" # –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
IDS_FILE_PATH = "user_ids_for_broadcast.txt" # –§–∞–π–ª —Å–æ —Å–ø–∏—Å–∫–æ–º ID

# --- –¢–ï–ö–°–¢ –°–û–û–ë–©–ï–ù–ò–Ø –î–õ–Ø –†–ê–°–°–´–õ–ö–ò ---
MESSAGE_TO_SEND = """
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!

–ù–∞ —Å–≤—è–∑–∏ –±–æ—Ç-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –û–ü–î. –ù–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è —è –±—ã–ª –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏, –Ω–æ —Å–µ–π—á–∞—Å —Å–Ω–æ–≤–∞ –≤ —Å—Ç—Ä–æ—é –∏ –≥–æ—Ç–æ–≤ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã.

–í—ã –º–æ–∂–µ—Ç–µ —Å–Ω–æ–≤–∞ –∑–∞–¥–∞–≤–∞—Ç—å –º–Ω–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /menu.
"""

async def send_broadcast():
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ —Ñ–∞–π–ª–∞.
    """
    # –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê
    if TELEGRAM_BOT_TOKEN == "–í–ê–®_–¢–û–ö–ï–ù_–ó–î–ï–°–¨":
        print("‚ùå –û–®–ò–ë–ö–ê: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π TELEGRAM_BOT_TOKEN.")
        return

    try:
        with open(IDS_FILE_PATH, "r") as f:
            user_ids = [line.strip() for line in f if line.strip()]
    except FileNotFoundError:
        print(f"‚ùå –û–®–ò–ë–ö–ê: –§–∞–π–ª —Å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π '{IDS_FILE_PATH}' –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ extract_ids.py.")
        return

    if not user_ids:
        print("‚ö†Ô∏è –§–∞–π–ª —Å ID –ø—É—Å—Ç. –†–∞—Å—Å—ã–ª–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞.")
        return

    print(f"–ù–∞—á–∏–Ω–∞—é —Ä–∞—Å—Å—ã–ª–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è {len(user_ids)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...")
    bot = Bot(token=TELEGRAM_BOT_TOKEN)
    
    success_count = 0
    fail_count = 0

    for user_id in user_ids:
        try:
            await bot.send_message(chat_id=int(user_id), text=MESSAGE_TO_SEND)
            print(f"  [+] –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
            success_count += 1
        except TelegramError as e:
            # –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞, –Ω–µ–≤–µ—Ä–Ω—ã–π ID
            print(f"  [-] –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}. –û—à–∏–±–∫–∞: {e.message}")
            fail_count += 1
        
        # –í–ê–ñ–ù–û: –î–µ–ª–∞–µ–º –Ω–µ–±–æ–ª—å—à—É—é –ø–∞—É–∑—É, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç—ã Telegram –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É
        await asyncio.sleep(0.1) 

    print("\n--- –†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ---")
    print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {success_count}")
    print(f"‚ùå –û—à–∏–±–æ–∫: {fail_count}")
    print(f"üìà –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {len(user_ids)}")


if __name__ == "__main__":
    asyncio.run(send_broadcast())